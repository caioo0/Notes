# **智能指针**

**智能指针**（*smart pointers*）是一类数据结构，它们的表现类似指针，但是也拥有额外的元数据和功能；

在 Rust 中，普通引用和智能指针的一个额外的区别是引用是一类只借用数据的指针；

相反，在大部分情况下，智能指针 **拥有** 它们指向的数据。

智能指针通常使用结构体实现。

智能指针区别于常规结构体的显著特性在于其实现了 `Deref` 和 `Drop` trait

- `Deref` trait 允许智能指针结构体实例表现的像引用一样，这样就可以编写既用于引用、又用于智能指针的代码。

- `Drop` trait 允许我们自定义当智能指针离开作用域时运行的代码。

标准库中最常用的一些智能指针：

- `BOX<T>`,用于在堆上分配值
- `Rc<T>`,一个引用计数类型，其数据可以有多个所有者
- `Ref<T>`和`RefMut<T>`,通过`RefCell<T>`访问（`RefCell<T>`是一个在运行时而不是在编译时执行借用规则的类型）

## [使用 `Box` 指向堆上的数据](https://rustwiki.org/zh-CN/book/ch15-01-box.html#使用-boxt-指向堆上的数据)

最简单直接的智能指针是 *box*，其类型是 `Box<T>`。 box 允许你将一个值放在堆上而不是栈上。留在栈上的则是指向堆数据的指针。如果你想回顾一下栈与堆的区别请参考第 4 章。

除了数据被储存在堆上而不是栈上之外，box 没有性能损失。不过也没有很多额外的功能。它们多用于如下场景：

- 当有一个在编译时未知大小的类型，而又想要在需要确切大小的上下文中使用这个类型值的时候
- 当有大量数据并希望在确保数据不被拷贝的情况下转移所有权的时候
- 当希望拥有一个值并只关心它的类型是否实现了特定 trait 而不是其具体类型的时候