# 函数

## 尾调用优化

**简介：**

ECMAScript规范新增了一项内存管理优化机制，让javascript引擎在满足条件时可以重用栈帧。



需要条件：

- 代码在严格模式下执行
- 外部函数的返回值对尾调用函数的调用；
- 尾调用函数返回后不需要执行额外的逻辑
- 尾调用函数不是引用外部函数作用域中自由变量的闭包；

> 之所以要求严格模式，主要因为在非严格模式下函数调用中允许使用f.arguments和f.caller，而它们都会引用外部函数的栈帧。显然，这意味着不能再应用优化，因此尾调用优化要求必须在严格模式下有效，以防止引用这些属性。



## 立即调用的函数表达式

立即调用的匿名函数又被称作`立即调用的函数表达式`(IIFE,Immediately Invoked Function Expressopn)。 它类似函数声明，但由于被包含在括号中，所以会被解释为函数表达式。紧跟着第一组括号后面的第二组括号就会立即调用前面的函数表示式。

```
(function () {
 // 块级作用域
})
```

 在es6及以前，为了防止变量定义外泄，IIFE是个非常有效的方式。这样也不会导致闭包相关的内存问题，因为不存在对这个匿名函数的引用。为此，只要函数执行完毕，其作用域链就可以被销毁。

 在es6之后，IIFE就没有那么必要了，因为块级作用域中的变量无须IIFE就可以实现同样的隔离。

```
{
	let i;
	for(i=0;i<count;i++){
		console.log(i)
	}
}

// 循环的块级作用域
for(let i = 0;i < count; i++){
  console.log(i)
}
console.log(i)  // 抛出错误！

// 说明IIFE用途的一个实际的例子，就是可以用它锁定参数值。比如：
const divs = document.querySelectorAll('div')

// 达不到目的
for(var i = 0; i< divs.length;i++){
  divs[i].addEventListener('click',function(){
    console.log(i)
  })
}

```

这里使用 `var` 关键字声明了循环迭代变量i，但这个变量并不会被限制for循环的块级作用域内。因此，渲染到页面上之后，点击每个div都会弹出元素总数。这是因为在执行淡季处理程序时，迭代变量的值已经上循环结束时的最终值了，即元素的个数。而且，这个变量存在于循环体外部，随时可以被访问。这里也可以用到 `IIFE` 解决。