# RPC？

- 什么是RPC？
- 它的原理是什么？
- 它有什么特点？
- 如果让你实现一个RPC框架，你会如何是实现？

## RPC概述

RPC是远程过程调用(Remote Procedure Call)。 RPC的主要功能目标是让构建分布式计算（应用）更容易，在提供强大的远程调用能力时不损失本地调用的语义简洁性。为实现该目标，RPC框架需提供一种透明调用机制，让使用者不必显式的区分本地调用和远程调用。

### RPC优点

1. 分布式设计
2. 部署灵活
3. 解构服务
4. 扩展性强



### 有哪些开源RPC框架

- **Dubbo**：国内最早开源的 RPC 框架，由阿里巴巴公司开发并于 2011 年末对外开源，仅支持 Java 语言。
- **Motan**：微博内部使用的 RPC 框架，于 2016 年对外开源，仅支持 Java 语言。
- **Tars**：腾讯内部使用的 RPC 框架，于 2017 年对外开源，仅支持 C++ 语言。
- **Spring****Cloud**：国外 Pivotal 公司 2014 年对外开源的 RPC 框架，提供了丰富的生态组件。
- **gRPC**：Google 于 2015 年对外开源的跨语言 RPC 框架，支持多种语言。
- **Thrift**：最初是由 Facebook 开发的内部系统跨语言的 RPC 框架，2007 年贡献给了 Apache 基金，成为Apache 开源项目之一，支持多种语言。

### 特性

- 1、RPC框架一般使用长链接，不必每次通信都要3次握手，减少网络开销。
- 2、RPC框架一般都有注册中心，有丰富的监控管理。发布、下线接口、动态扩展等，对调用方来说是无感知、统一化的操作协议私密，安全性较高
- 3、RPC 协议更简单内容更小，效率更高，服务化架构、服务化治理，RPC框架是一个强力的支撑。

###  架构



![RPC原理分析和架构设计要点_daiwei-dave的博客-CSDN博客_rpc设计要点](https://tse4-mm.cn.bing.net/th/id/OIP-C.gNfmVJx9Rg9cSYt4qW8J1AHaFP?pid=ImgDet&rs=1)

###  调用流程

![img](img\v2-6b87c85f47ab2cc8d24228df59269e7e_720w.webp)

**具体步骤：**

1. 服务消费者（client客户端）通过本地调用的方式调用服务。
2. 客户端存根（client stub）接收到请求后负责将方法、入参等信息序列化（组装）成能够进行网络传输的消息
   体。
3. 客户端存根（client stub）找到远程的服务地址，并且将消息通过网络发送给服务端。
4. 服务端存根（server stub）收到消息后进行解码（反序列化操作）。
5. 服务端存根（server stub）根据解码结果调用本地的服务进行相关处理。
6. 本地服务执行具体业务逻辑并将处理结果返回给服务端存根（server stub）。
7. 服务端存根（server stub）将返回结果重新打包成消息（序列化）并通过网络发送至消费方。
8. 客户端存根（client stub）接收到消息，并进行解码（反序列化）。
9. 服务消费方得到最终结果。

**涉及到的技术**

1. 动态代理
   生成Client Stub（客户端存根）和Server Stub（服务端存根）的时候需要用到java动态代理技术。
2. 序列化 在网络中，所有的数据都将会被转化为字节进行传送，需要对这些参数进行序列化和反序列化操作。目前主流高效的开源序列化框架有Kryo、fastjson、Hessian、Protobuf等。
3. NIO通信
   Java 提供了 NIO 的解决方案，Java 7 也提供了更优秀的 NIO.2 支持。可以采用Netty或者mina框架来解决NIO数据传输的问题。开源的RPC框架Dubbo就是采用NIO通信，集成支持netty、mina、grizzly。
4. 服务注册中心
   通过注册中心，让客户端连接调用服务端所发布的服务。主流的注册中心组件：Redis、Zookeeper、Consul、Etcd。Dubbo采用的是ZooKeeper提供服务注册与发现功能。
5. 负载均衡
   在高并发的场景下，需要多个节点或集群来提升整体吞吐能力。
6. 健康检查
   健康检查包括，客户端心跳和服务端主动探测两种方式。

## RPC深入解析



## 序列化技术

在网络传输中，数据必须采用二进制形式， 所以在RPC调用过程中， 需要采用序列化技术，对入参对象和返回值对象进行序列化与反序列化。

#### **如何序列化？**

![img](.\img\v2-649da26d6c60095cd104516e99d78a91_720w.webp)

## 资料

https://zhuanlan.zhihu.com/p/374901408#

