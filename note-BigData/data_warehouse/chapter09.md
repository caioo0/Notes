# 第9章 多值维度和桥接表
---
```md
A watched pot never boils.
眼睛盯着看的壶永远不会开。
```

- 多值维度  当事实表的额行涉及维度表中的多行时，将产生多值维度。
- 多值属性  当一个维度行需要获取单一属性的多个值时，将产生多值属性。

桥接表可以解决上述问题，同时桥接表的使用增加了误用模式的可能性，会导致不准确结果的产生。

本章学习要点：

- 多数维度表和事实表之间的一对多关系
- 多值维度表和多值维度属性
- 标准设计方法解决问题的限制，桥接表如何解决这类问题，以及由此带来的问题，并以一种新的思路考虑缓慢变化过程。


## 9.1 标准的一对多关系 

又称主从或者父-子关系。具有简单性而使应用非常方便。对于复杂的现实世界，出现更多关系事实与一个或多个维度的实例关联的情况。

引用雪花模式可能胡满足这种情况的需求，但是这样做的结果将在需要准确报表时，引入新的复杂问题。


## 9.2 多值维度 

解决多值维度问题：

- 一个方案是在事实表中包含多个键值。

- 另一种替代方法是采用一类特殊表桥接事实表与维度表的关联。

### 9.2.1 简化关系 


处理多值维度最简单的方法是，将多对多关系分解成两个或多个一对多关系。 

缺点：
- 导致某些类型的报表更加复杂。
- 进能够处理固定数量的关系。

```md 
技巧：
事实表和维度表之间的多值关系可以通过将多值关系分解为多个一对多关系来解决，然而，该方法是报表更加复杂并且仅支持数量有限的关系。
```

### 9.2.2  为多值维度构建桥接表



1. 桥接关系

定义： 多值维度问题可以通过在事实表和维度表之间开发一组表来解决。无须直接引用维度表，每个事实表将引用一组表。改组表被称为桥接表。 

桥接表将事实表和维度表连接起来。

特点： 灵活并且简化了生成报表的难度，但是可能带来双重计算的风险。

2. 引入双重计算

为简单起见，本书使用双重计算这一术语来描述事实被多次计算的情况。如您所见，在一些情况下，错误可能更严重。

何时需要双重计算？ 

在采用桥接表时，每个事实可能与维度表中的多行关联，这种情况带来了产生重复计算的可能性，有时双重计算是有效的额，但在建立查询或者产生报表时非常容易出现错误。

构建有影响报表的唯一安全方法是，对维度中分组成员具有为一列进行分组，通常，该列是自然键。


通过增加分配因子消除双重计算的风险。


```md
技巧：
双重计算可以通过在桥接表中增加分配因子并聚集分配的实施来避免。分配银子的所有权在于商业领域，而不是在技术领域，如果存在清楚的分配银子，可以考虑改变事实表粒度的可能性，加以替换。
```

另一种避免双重计算的方法是对没有经验的用户隐藏桥接表的存在。这一方法的实现是通过采用仅包含一个维度行的简化方案补充桥接表。

```md
技巧：
在维度表与事实表间设计桥接表时，采用隔离主角色的一对多直接关系补充桥接表。尽管一些形式的报表需要桥接表，采用该方法时却无须担心双重计算问题。
```

**桥接表的其他影响**

- 缓慢变化：被桥接的维度行包含类型1变化，这种行为是希望具备的，如果包含类型2变化，党成员合作再次发生时，需要建立一个新组。


## 9.3 多值属性

维度表中某一属性具有多个值的情况。

针对多值属性，考虑将其简化为固定数量的单值属性。如果重复的属性不被用于过滤或分组查询结果，这种方法就是最简单的选择。

简化多值属性的缺点比较熟悉，解决方案也是引入桥接表。



## 9.4 本章小结 

本章提供了工具，已解决现实中存在的采用一对多关系无法解决的维度表与事实表之间的复杂性问题。要点如下：
- 当某个事实需要引用维度中的多个实例时，可以采用将多对多关系简化为多个一对多关系的方法。
- 简化的方法可能难以获得满足的效果，因为该方法将导致多种类型报表的构建更见困难，并且仅支持固定数量的维度值。
- 桥接表能够保证事实表的行与维度表中任意数量的行关联，简化了报表的构建。
- 桥接表容易导致对事实的双重计算，因此必须认真控制其存取和使用。
- 桥接关系中可以包含分配银子，或采用将单一实例表示为主要角色的方法简化关系。
- 如果采用的工具对多对多关系有限制，可以将桥接带来的多对多关系通过交叉表方式进行分解。
- 使用桥接表需要仔细考虑缓慢变化的含义，不仅是对属性，而且需要考虑关系。
- 属性桥接与维度桥接的方法类似，但属性桥接表位于维度表与支架表之间。
- 因为桥接表与事实表一样包含了多个外键，所以一些工具将桥接表视为事实表，这种考虑是可行的，但需要确信工具不会采用横向钻取。
- 缓慢变化的细节将以有趣的方式影响桥接方案。类型2变化会产生连锁反应，影响多个表中的多行。
