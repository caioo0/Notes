# 第4章 过程处理中的事实表
---

```md
Everything you see exists together in a delicate balance
世间万物，相互制衡，共存于此。
```

单一的事实表一般很难描述某个主题区域。在实际运用中，企业通常不可能由单个事实表就能够描述清楚，多数情况下都需要多个事实表来描述。

简单有效的方法是在维度设计时，为每个待处理的过程构建单个事实表。 

## 4.1 事实表与业务过程 

维度模型描述了人们对所处世界的度量。 每个星型模式都包含一个事实表，作为描述特定过程的度量。

度量又称事实，通过相关的维度获得存在的环境。

事实表的粒度描述了所记录的事实的细节层次。

一个简单有效的规则决定了跨事实表的事实的分布：

```md
技巧：
为便于独立地分析研究，应为每个过程建立一个事实表。
```

当设计者采纳上述指导原则时，对于需要多个事实表，还是仅需要一个事实表。与其采用过程建模（实体-关系模型，过程分解）的概念驱动星型模式的开发，不如采用两个简单的测试，用于将度量划分到不同的事实表中。

```md
技巧：
对于给定的两个事实，提出两个问题：
（1） 这些事实同时发生吗？
（2） 这些事实可用于同一个细节层次（粒度）上吗？
如果其中任何一个问题的答案是否定的，就表明事实表表示不同的过程。就需要多个事实表。 

注意：
为将要独立研究的每个过程都构建一个事实表。尽管这一原则非常重要，但并不是每个事实表都只对应一个过程。
在对过程进行比较时，构建适合多个过程的事实表非常有效。这类事实表通过获取多个事实表的数据形成，可能也会包含聚集数据。例如，可以通过建立汇总了计划、订单、发货、退货等多个星型模式的星型模式支持对销售的分析。
如果不需要对过程开展独立的分析活动，可能会忽略掉单独过程的事实表。在此情况下，如果用户希望关注某个事实，将会出现困难。
```

## 4.2 具有不同时间的事实

如果描述事件的两个或两个以上的事实不在同一时间发生，这些事实描述的就是不同的过程。如果这些事实被放入单独的事实表中，将难以对单独的过程进行分析。因此将这些事实放入不同的事实表将会使对每个过程的研究变得更加容易。

- 单一事实表带来的问题：会产生冗余的数据不必要的数据，增加查询复杂性；
- 以不同的事实表的方式建模：推荐，每个事实表仅存储适当的事实，不需要记录无用的值。

## 4.3 具有不同粒度的事实：

当描述事件的两个或多尔衮事实具有不同的粒度时，它们描述的是不同的过程。与具有不同时间的事实类似，若将其放入单一的事实表中，将会对单一过程的分析造成困难。将它们放入不同的事实表中会使每个过程的分析变得容易。

- 单一事实表带来的问题：会产生冗余的数据不必要的数据，增加查询复杂性；
- 以不同的事实表的方式建模：推荐，每个事实表仅存储适当的事实，不需要记录无用的值。


## 4.4 从多个事实表中分析事实

对单一过程的分析是有用的，对不同的单一过程进行比较也同样重要。

### 4.4.1 连接事实表的危险 

可以认为维度表和事实表具有父子关系，其中维度表可视为父子关系的父节点。如果某个维度和多个事实表关联，事实表中行可视为具有兄弟关系。他们具有相同的父节点。

不要试图对事实表进行连接操作，无论是直接操作还是通过维度表操作。对事实表的连接操作将会产生不正确的结果。


### 4.4.2 横向钻取 

比较两个过程的适当方法使横向钻取，该术语意在描述跨多个过程。通常被称为横向钻取查询，但横向钻取操作通常通过多个查询来实现。

横向钻取通过将数据集分解为多个步骤来实现：

第一步： 使按照相同的细节层次从每个星型模式中汇总事实。
第二步：合并汇总的事实。

横向钻取技术可应用与两个或两个以上的星型模式，跨越多个数据库，伸着跨越存储在不同厂商关系数据库管理系统中的数据。也可以采用对星型模式查询多次的方法将横向钻取技术应用于星型模式上，以便建立可用的对比报表。

```md 
技巧：
跨过程比率是强有力的度量。因为这种方法无须对应单一列或单一表，常常丢失在设计工具和报表软件收集的元数据中。这些比率在设计阶段应该被文档化，从而强调可以被星型模式支持的业务过程之间的交互。
```

维度的"同义性"对横向钻取来说是至关重要的。维度的一致性是确保跨越多个星型模式甚至多个主题区域开展分析工作的关键。


## 4.5 本章小结

本章采用关键的步骤来消除基本星型模式对待现实世界存在的更加复杂问题描述的简单性。 讨论了如何以及为什么需要用不同的事实表区分不同的过程，如何构建跨过程分析的查询等。

- 在处理多过程时，采用不同事实表表示不同过程的方法将消除对独立过程分析带来的问题。
- 在不能确定两个事实表描述的是否是不同过程时，可以通过分析它们发生时间是否不同、或是否具有不同的粒度来确定。如果不在同一时间发生或具有不同的粒度，它们就表示不同的过程。
- 采用单一事实表描述多个过程时，会妨碍对单一事实表的分析。
- 将多个事实表中的信息合并在单一报表时，直接或通过公共维度连接两个事实表，可能会导致对一些事实的过量计算，造成对事实计算的错误。
- 合并信息的适当方法是将专区分两个阶段展开：第一个阶段从每个星型模式中收集信息并以公共细节层次聚集，第二阶段将中间结果集合并。
- 横向钻取可采用多种方法。如果工具集不支持可采用的方法或者性能较差，可以建立合并事实表活多维数据集，预先计算横向钻取结果。











