# 第8章 深入学习缓慢变化技术
---
```md
Each snowflake is a letter from the sky。
每片雪花都是天空的一封来信。
```

星型模式设计的一个关键部分是确定如何将源数据的变化反应到维度表上，以保证星型模式中维度属性的变化模式能够与业务需求匹配。

- **类型1**  当数据元素的历史记录不重要时使用类型1. 
- **类型2**  当保存发生变化的数据元素的历史情况非常重要时采用类型2.

附加技术：

- **时间戳维度** 当需要支持对维度值的特定时间分析，与事实无关时采用时间戳维度。
- **变化类型3** 当客户需要研究所有的额事实 --- 数据元素发生变化前后的记录 --- 使用新值或旧值时，采用变化类型3.
- **混合技术** 当需求冲突、需要采用多种响应方式时，采用混合技术。

 时间戳维度

对源数据发生最常见的响应方法是采用类型2缓慢变化维度。 如果对于历史数据的需求有任何的不确定性，安全的选择是选择类型2响应。

但是类型2响应有一个明显的缺点：他不能说明在某一个特定时间上维度看起来像什么。

在维度表中，时间戳维度允许三种形式的特定时间分析：
- 方便地按时间顺序对变化的历史情况进行排序。
- 快速选择影响特定日期的维度行。
- 容易确定当前受到影响的维度行。


**利用时间戳维度对类型2变化进行补充**

- 类型2变化保存事实的历史环境，但是不能开展针对维度的时间点分析。
- 事实表可以用于记录维度表的变化历史，它将每个版本与有效的时间范围相关联。事实表和维度表有相同的行数。
- 在没有要求使用额外事实表的情况下，时间戳维度可以完成同样的工作。通过添加有效和截至日期来实现，通过对这些列的维护，可以使用相同自然键的两行不重叠。
- 可以使用effective_data来对交易历史进行排序. effective_date 和 expiration_date 可以一同用于过滤在特定时间点的有效记录。添加most_recent_row标记可以很容易的从维度中选择当前的记录。
- 时间戳维度很难加载，但是很容易加载关联的事实表。
- 时间戳维度可能包含一些属性，行为类型一些查询中的维度，以及另一些查询中的事实。

**类型3变化提供了历史情况的不同方面**

- 不管合适发生变化，当用户想要连接所有事实的新值或旧值，类型1和类型2都是不充分的。
- 正如类型1变化一样，类型3的解决方案包含维护属性的当前值，并且添加一列用来获得先前值。
- 通过选择适当的列可以使用任何一个值进行分析。
- 存在多个版本是可能的，但当添加新列或者在构建报表时写入特定的版本时，将会导致需要对报表定义进行修改的情况发生。

**混合的1/2类型变化允许类型1和类型2响应**

- 当看起来矛盾的要求需要将一个属性来同事当作类型1和类型2时，可以设计两个属性。
- 一个属性作为类型1变化属性：当来源值发生变化时，它将更新并且能用于研究当前值的所有事实。
- 另一个属性作为类型2变化属性：当发生变化时，在维度表中插入新航。这个属性用来对需要精确历史值的事实进行分类。
- 仔细地命名或使用视图来隐藏较少使用的属性，可以避免给终端用户带来困惑。分析人员和报表开发人员应该研究属性之间的区别，以适当地使用它们。


